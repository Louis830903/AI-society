# å‰ç«¯ç•Œé¢è§„æ ¼è¯´æ˜

## è®¾è®¡åŸåˆ™

- **è§‚å¯Ÿä¸ºä¸»**: ç”¨æˆ·æ˜¯è§‚å¯Ÿè€…,ä¸æ˜¯ç©å®¶
- **ä¿¡æ¯ä¸°å¯Œ**: ä¸€çœ¼èƒ½çœ‹åˆ°ä¸–ç•Œåœ¨å‘ç”Ÿä»€ä¹ˆ
- **æµç•…ä½“éªŒ**: 60fpsæ¸²æŸ“,å®æ—¶æ›´æ–°
- **ç®€æ´ä¼˜é›…**: ä¸èŠ±å“¨,è®©å†…å®¹è¯´è¯

å°±åƒè§‚çœ‹çºªå½•ç‰‡ï¼šç”»é¢æµç•…,ä¿¡æ¯æ¸…æ™°,ä¸å–§å®¾å¤ºä¸»ã€‚

## æŠ€æœ¯æ ˆ

```
æ¡†æ¶: React 18 (å‡½æ•°ç»„ä»¶ + Hooks)
æ„å»º: Vite 5
æ¸²æŸ“: Pixi.js 8 (WebGL 2Dæ¸²æŸ“)
çŠ¶æ€: Zustand (è½»é‡çŠ¶æ€ç®¡ç†)
æ ·å¼: TailwindCSS 3
å›¾è¡¨: Recharts
é€šä¿¡: åŸç”ŸWebSocket
è¯­è¨€: TypeScript 5
```

## é¡µé¢å¸ƒå±€

### ä¸»ç•Œé¢ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Logo] AI Society è‡ªæ²»ä¸–ç•Œå®éªŒ     [æ—¶é—´æ˜¾ç¤º] Day 15 14:30     [æ§åˆ¶] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                  â”‚  â”‚  æ™ºèƒ½ä½“é¢æ¿                â”‚ â”‚
â”‚  â”‚                                  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚                                  â”‚  â”‚  â”‚ ğŸ” æœç´¢æ™ºèƒ½ä½“...     â”‚  â”‚ â”‚
â”‚  â”‚                                  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚ â”‚
â”‚  â”‚        ä¸–ç•Œåœ°å›¾                  â”‚  â”‚  â”‚ ğŸŸ¢ ææ˜ (ç¨‹åºå‘˜)     â”‚  â”‚ â”‚
â”‚  â”‚        (Pixi.js Canvas)          â”‚  â”‚  â”‚    ğŸ“ å’–å•¡é¦†         â”‚  â”‚ â”‚
â”‚  â”‚                                  â”‚  â”‚  â”‚    ğŸ’­ å’Œæœ‹å‹èŠå¤©     â”‚  â”‚ â”‚
â”‚  â”‚        - ä½ç½®æ ‡æ³¨                â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚ â”‚
â”‚  â”‚        - æ™ºèƒ½ä½“ç²¾çµ              â”‚  â”‚  â”‚ ğŸŸ¢ ç‹èŠ³ (è®¾è®¡å¸ˆ)     â”‚  â”‚ â”‚
â”‚  â”‚        - å¯¹è¯æ°”æ³¡                â”‚  â”‚  â”‚    ğŸ“ å’–å•¡é¦†         â”‚  â”‚ â”‚
â”‚  â”‚        - ç§»åŠ¨è½¨è¿¹                â”‚  â”‚  â”‚    ğŸ’­ å’Œæœ‹å‹èŠå¤©     â”‚  â”‚ â”‚
â”‚  â”‚                                  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚ â”‚
â”‚  â”‚                                  â”‚  â”‚  â”‚ ğŸŸ¡ å¼ å (è€å¸ˆ)       â”‚  â”‚ â”‚
â”‚  â”‚                                  â”‚  â”‚  â”‚    ğŸ“ å­¦æ ¡           â”‚  â”‚ â”‚
â”‚  â”‚                                  â”‚  â”‚  â”‚    ğŸ’­ ä¸Šè¯¾ä¸­         â”‚  â”‚ â”‚
â”‚  â”‚                                  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  å®æ—¶äº‹ä»¶æµ                                                        â”‚ â”‚
â”‚  â”‚  14:30 ææ˜ å¯¹ ç‹èŠ³ è¯´: "æœ€è¿‘é¡¹ç›®å¿™å—?"                           â”‚ â”‚
â”‚  â”‚  14:29 ç‹èŠ³ èµ°è¿›äº† æ—¶å…‰å’–å•¡é¦†                                     â”‚ â”‚
â”‚  â”‚  14:28 ç³»ç»Ÿ: æ–°å±…æ°‘ é™ˆæ™¨ æ¬å…¥äº†å°é•‡                               â”‚ â”‚
â”‚  â”‚  14:25 å¼ å å¼€å§‹ ä¸Šè¯¾                                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å“åº”å¼å¸ƒå±€

```css
/* å¤§å±å¹• (>1400px): åœ°å›¾å 60%,å³ä¾§é¢æ¿40% */
/* ä¸­å±å¹• (1000-1400px): åœ°å›¾å 55%,å³ä¾§é¢æ¿45% */
/* å°å±å¹• (<1000px): åœ°å›¾å…¨å®½,é¢æ¿å¯æŠ˜å  */
```

## ç»„ä»¶è®¾è®¡

### 1. é¡¶éƒ¨å¯¼èˆªæ  (TopBar)

```typescript
interface TopBarProps {
  worldTime: Date;
  dayCount: number;
  status: 'running' | 'paused';
  onPause: () => void;
  onResume: () => void;
  onSpeedChange: (speed: number) => void;
}

// åŠŸèƒ½:
// - æ˜¾ç¤ºLogoå’Œé¡¹ç›®åç§°
// - æ˜¾ç¤ºæ¸¸æˆå†…æ—¶é—´ (Day 15 14:30 ä¸‹åˆ)
// - æ˜¾ç¤ºç°å®æ—¶é—´
// - æ§åˆ¶æŒ‰é’®: æš‚åœ/ç»§ç»­, åŠ é€Ÿ(1x/2x/5x)
// - å…¨å±åˆ‡æ¢
// - è®¾ç½®å…¥å£
```

### 2. ä¸–ç•Œåœ°å›¾ (WorldMap)

```typescript
interface WorldMapProps {
  width: number;
  height: number;
  locations: Location[];
  agents: Agent[];
  conversations: ActiveConversation[];
  selectedAgentId?: string;
  onAgentClick: (agentId: string) => void;
  onLocationClick: (locationId: string) => void;
}

// åŠŸèƒ½:
// - Pixi.jsæ¸²æŸ“2000x2000ä¸–ç•Œ
// - å¯ç¼©æ”¾(æ»šè½®)ã€å¯æ‹–æ‹½
// - æ˜¾ç¤ºæ‰€æœ‰ä½ç½®(å»ºç­‘ç‰©)
// - æ˜¾ç¤ºæ‰€æœ‰æ™ºèƒ½ä½“(ç²¾çµå›¾)
// - æ˜¾ç¤ºå¯¹è¯æ°”æ³¡(æ­£åœ¨å¯¹è¯çš„æ™ºèƒ½ä½“å¤´é¡¶)
// - ç‚¹å‡»æ™ºèƒ½ä½“é«˜äº®å¹¶æ˜¾ç¤ºè¯¦æƒ…
// - ç‚¹å‡»ä½ç½®æ˜¾ç¤ºä½ç½®ä¿¡æ¯
// - çƒ­åŠ›å›¾æ¨¡å¼(å¯é€‰)

// Pixi.jså›¾å±‚:
// 1. èƒŒæ™¯å±‚: åœ°é¢ã€é“è·¯
// 2. å»ºç­‘å±‚: ä½ç½®å»ºç­‘ç‰©
// 3. æ™ºèƒ½ä½“å±‚: æ™ºèƒ½ä½“ç²¾çµ
// 4. æ•ˆæœå±‚: å¯¹è¯æ°”æ³¡ã€é€‰ä¸­é«˜äº®
// 5. UIå±‚: æ ‡ç­¾ã€æŒ‡ç¤ºå™¨
```

### 3. æ™ºèƒ½ä½“ç²¾çµ (AgentSprite)

```typescript
interface AgentSpriteProps {
  agent: Agent;
  isSelected: boolean;
  isTalking: boolean;
  onClick: () => void;
}

// è§†è§‰è®¾è®¡:
// - åœ†å½¢å¤´åƒ(æ ¹æ®æ€§åˆ«/èŒä¸šç”Ÿæˆ)
// - åå­—æ ‡ç­¾(é¼ æ ‡æ‚¬åœæ˜¾ç¤º)
// - çŠ¶æ€æŒ‡ç¤ºå™¨:
//   - ğŸŸ¢ ç»¿è‰²è¾¹æ¡†: æ­£å¸¸æ´»åŠ¨
//   - ğŸŸ¡ é»„è‰²è¾¹æ¡†: å·¥ä½œä¸­
//   - ğŸ”µ è“è‰²è¾¹æ¡†: æ­£åœ¨å¯¹è¯
//   - ğŸ˜´ ç°è‰²: ç¡è§‰
// - æƒ…ç»ªå›¾æ ‡(å°è¡¨æƒ…)
// - ç§»åŠ¨æ—¶æ˜¾ç¤ºè½¨è¿¹çº¿(æ·¡å‡º)
```

### 4. å¯¹è¯æ°”æ³¡ (ChatBubble)

```typescript
interface ChatBubbleProps {
  speakerName: string;
  content: string;
  emotion: string;
  position: { x: number; y: number };
  duration?: number; // æ˜¾ç¤ºæ—¶é•¿,é»˜è®¤5ç§’
}

// è§†è§‰è®¾è®¡:
// - ç™½è‰²åœ†è§’çŸ©å½¢
// - è¯´è¯äººåå­—(å°å­—,ç°è‰²)
// - å¯¹è¯å†…å®¹(æ­£æ–‡)
// - å·¦ä¸‹è§’å°ä¸‰è§’æŒ‡å‘è¯´è¯äºº
// - æ·¡å…¥æ·¡å‡ºåŠ¨ç”»
// - æƒ…ç»ªå¯¹åº”èƒŒæ™¯è‰²å¾®è°ƒ:
//   - happy: æ·¡é»„
//   - sad: æ·¡è“
//   - angry: æ·¡çº¢
//   - neutral: ç™½è‰²
```

### 5. æ™ºèƒ½ä½“åˆ—è¡¨é¢æ¿ (AgentListPanel)

```typescript
interface AgentListPanelProps {
  agents: Agent[];
  selectedAgentId?: string;
  onSelectAgent: (agentId: string) => void;
  filter: AgentFilter;
  onFilterChange: (filter: AgentFilter) => void;
}

interface AgentFilter {
  search: string;
  occupation?: string;
  status?: 'all' | 'active' | 'talking' | 'working' | 'idle';
  sortBy: 'name' | 'activity' | 'wealth';
}

// åŠŸèƒ½:
// - æœç´¢æ¡†(æŒ‰åå­—æœç´¢)
// - ç­›é€‰å™¨(èŒä¸šã€çŠ¶æ€)
// - æ™ºèƒ½ä½“åˆ—è¡¨(å¯æ»šåŠ¨)
// - æ¯é¡¹æ˜¾ç¤º:
//   - å¤´åƒ
//   - åå­—+èŒä¸š
//   - å½“å‰ä½ç½®
//   - å½“å‰çŠ¶æ€/æƒ³æ³•
//   - çŠ¶æ€æŒ‡ç¤ºå™¨(é¢œè‰²ç‚¹)
// - ç‚¹å‡»é€‰ä¸­,åœ°å›¾è·Ÿéš
```

### 6. æ™ºèƒ½ä½“è¯¦æƒ…é¢æ¿ (AgentDetailPanel)

```typescript
interface AgentDetailPanelProps {
  agent: AgentDetail;
  onClose: () => void;
  onFollowToggle: () => void;
}

// å¸ƒå±€:
// â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
// â”‚ [å¤´åƒ]  ææ˜, 28å²           â”‚
// â”‚         ç¨‹åºå‘˜               â”‚
// â”‚         ğŸ’­ "åœ¨å’Œæœ‹å‹èŠå¤©"    â”‚
// â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
// â”‚ æ€§æ ¼                         â”‚
// â”‚ å¤–å‘ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80          â”‚
// â”‚ å‹å–„ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 65          â”‚
// â”‚ å°½è´£ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 85          â”‚
// â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
// â”‚ çŠ¶æ€                         â”‚
// â”‚ âš¡ èƒ½é‡: 75/100              â”‚
// â”‚ ğŸ’¬ ç¤¾äº¤: 80/100              â”‚
// â”‚ ğŸ˜Š å¹¸ç¦: 72/100              â”‚
// â”‚ ğŸ’° ä½™é¢: Â¥5,230              â”‚
// â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
// â”‚ ç¤¾äº¤å…³ç³»                     â”‚
// â”‚ ğŸ‘« ç‹èŠ³ (æœ‹å‹) â™¥â™¥â™¥â™¥â™¡ 68     â”‚
// â”‚ ğŸ‘¥ å¼ å (è®¤è¯†) â™¥â™¥â™¡â™¡â™¡ 35     â”‚
// â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
// â”‚ æœ€è¿‘è®°å¿†                     â”‚
// â”‚ â€¢ 14:20 åœ¨å’–å•¡é¦†é‡åˆ°ç‹èŠ³    â”‚
// â”‚ â€¢ 12:00 åœ¨é¤å…åƒåˆé¥­        â”‚
// â”‚ â€¢ 09:00 å¼€å§‹å·¥ä½œ            â”‚
// â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7. å®æ—¶äº‹ä»¶æµ (EventStream)

```typescript
interface EventStreamProps {
  events: WorldEvent[];
  maxDisplay?: number; // é»˜è®¤æ˜¾ç¤ºæœ€è¿‘20æ¡
  filter: EventFilter;
  onFilterChange: (filter: EventFilter) => void;
}

interface EventFilter {
  types: ('conversation' | 'move' | 'relationship' | 'system')[];
  agentId?: string; // åªçœ‹æŸæ™ºèƒ½ä½“çš„äº‹ä»¶
}

// äº‹ä»¶æ ¼å¼:
// [14:30] ææ˜ å¯¹ ç‹èŠ³ è¯´: "æœ€è¿‘é¡¹ç›®å¿™å—?"
// [14:29] ç‹èŠ³ èµ°è¿›äº† æ—¶å…‰å’–å•¡é¦†
// [14:28] ç³»ç»Ÿ: æ–°å±…æ°‘ é™ˆæ™¨ æ¬å…¥äº†å°é•‡
// [14:27] ææ˜ â†” ç‹èŠ³ å…³ç³»æå‡ (+3)

// åŠŸèƒ½:
// - å®æ—¶æ»šåŠ¨(æ–°äº‹ä»¶è‡ªåŠ¨æ»šåˆ°é¡¶éƒ¨)
// - ç‚¹å‡»äº‹ä»¶è·³è½¬åˆ°ç›¸å…³æ™ºèƒ½ä½“/ä½ç½®
// - æŒ‰ç±»å‹ç­›é€‰
// - æš‚åœæ»šåŠ¨(é¼ æ ‡æ‚¬åœæ—¶)
```

### 8. ç»Ÿè®¡é¢æ¿ (StatsPanel)

```typescript
interface StatsPanelProps {
  stats: WorldStats;
}

// æ˜¾ç¤ºå†…å®¹:
// - äººå£ç»Ÿè®¡: 52äºº
// - èŒä¸šåˆ†å¸ƒé¥¼å›¾
// - æ´»è·ƒå¯¹è¯æ•°: 8
// - ä»Šæ—¥å¯¹è¯æ€»æ•°: 89
// - çƒ­é—¨åœ°ç‚¹: å’–å•¡é¦†(12äºº)
// - ç»æµæŒ‡æ ‡: å¹³å‡è´¢å¯Œ Â¥5,481
```

### 9. ç¤¾äº¤ç½‘ç»œå›¾ (SocialNetworkGraph)

```typescript
interface SocialNetworkGraphProps {
  agents: Agent[];
  relationships: Relationship[];
  highlightAgentId?: string;
}

// åŠ›å¯¼å‘å›¾:
// - èŠ‚ç‚¹: æ™ºèƒ½ä½“(å¤§å°=ç¤¾äº¤è¿æ¥æ•°)
// - è¾¹: å…³ç³»(ç²—ç»†=å…³ç³»å¼ºåº¦,é¢œè‰²=å…³ç³»ç±»å‹)
// - å¯æ‹–æ‹½ã€å¯ç¼©æ”¾
// - æ‚¬åœæ˜¾ç¤ºå…³ç³»è¯¦æƒ…
// - ç‚¹å‡»èŠ‚ç‚¹é€‰ä¸­æ™ºèƒ½ä½“
```

## çŠ¶æ€ç®¡ç†

### Zustand Storeç»“æ„

```typescript
// stores/worldStore.ts
interface WorldStore {
  // çŠ¶æ€
  worldTime: Date;
  dayCount: number;
  status: 'running' | 'paused';
  timeScale: number;
  
  // åŠ¨ä½œ
  setWorldTime: (time: Date) => void;
  pause: () => void;
  resume: () => void;
  setTimeScale: (scale: number) => void;
}

// stores/agentStore.ts
interface AgentStore {
  // çŠ¶æ€
  agents: Map<string, Agent>;
  selectedAgentId: string | null;
  followingAgentId: string | null;
  
  // åŠ¨ä½œ
  updateAgent: (id: string, updates: Partial<Agent>) => void;
  selectAgent: (id: string | null) => void;
  followAgent: (id: string | null) => void;
  addAgent: (agent: Agent) => void;
  removeAgent: (id: string) => void;
}

// stores/eventStore.ts
interface EventStore {
  // çŠ¶æ€
  events: WorldEvent[];
  maxEvents: number;
  
  // åŠ¨ä½œ
  addEvent: (event: WorldEvent) => void;
  clearEvents: () => void;
}

// stores/conversationStore.ts
interface ConversationStore {
  // çŠ¶æ€
  activeConversations: Map<string, Conversation>;
  
  // åŠ¨ä½œ
  startConversation: (conv: Conversation) => void;
  addMessage: (convId: string, message: Message) => void;
  endConversation: (convId: string) => void;
}
```

## WebSocketé›†æˆ

```typescript
// hooks/useWebSocket.ts
export function useWebSocket(url: string) {
  const [isConnected, setIsConnected] = useState(false);
  const wsRef = useRef<WebSocket | null>(null);
  
  const agentStore = useAgentStore();
  const eventStore = useEventStore();
  const conversationStore = useConversationStore();
  
  useEffect(() => {
    const ws = new WebSocket(url);
    
    ws.onopen = () => {
      setIsConnected(true);
      ws.send(JSON.stringify({ type: 'subscribe', channels: ['all'] }));
    };
    
    ws.onmessage = (event) => {
      const data = JSON.parse(event.data);
      
      switch (data.type) {
        case 'agent_move':
          agentStore.updateAgent(data.data.agent_id, {
            x: data.data.to.x,
            y: data.data.to.y
          });
          break;
          
        case 'conversation_message':
          conversationStore.addMessage(data.data.conversation_id, data.data);
          eventStore.addEvent(data);
          break;
          
        // ... å…¶ä»–äº‹ä»¶ç±»å‹
      }
    };
    
    wsRef.current = ws;
    
    return () => ws.close();
  }, [url]);
  
  return { isConnected };
}
```

## åŠ¨ç”»ä¸äº¤äº’

### Pixi.jsåŠ¨ç”»

```typescript
// æ™ºèƒ½ä½“ç§»åŠ¨åŠ¨ç”»
function animateAgentMove(sprite: PIXI.Sprite, from: Point, to: Point, duration: number) {
  const startTime = performance.now();
  
  const animate = (currentTime: number) => {
    const elapsed = currentTime - startTime;
    const progress = Math.min(elapsed / duration, 1);
    
    // ç¼“åŠ¨å‡½æ•°(ease-out)
    const easeProgress = 1 - Math.pow(1 - progress, 3);
    
    sprite.x = from.x + (to.x - from.x) * easeProgress;
    sprite.y = from.y + (to.y - from.y) * easeProgress;
    
    if (progress < 1) {
      requestAnimationFrame(animate);
    }
  };
  
  requestAnimationFrame(animate);
}

// å¯¹è¯æ°”æ³¡æ·¡å…¥æ·¡å‡º
function animateBubble(bubble: PIXI.Container, fadeIn: boolean, duration: number = 300) {
  const startAlpha = fadeIn ? 0 : 1;
  const endAlpha = fadeIn ? 1 : 0;
  
  bubble.alpha = startAlpha;
  
  const animate = (progress: number) => {
    bubble.alpha = startAlpha + (endAlpha - startAlpha) * progress;
  };
  
  // ä½¿ç”¨PIXI.Tickeræˆ–requestAnimationFrame
}
```

### äº¤äº’å“åº”

```typescript
// åœ°å›¾ç¼©æ”¾
function handleWheel(event: WheelEvent) {
  const scaleDelta = event.deltaY > 0 ? 0.9 : 1.1;
  const newScale = Math.max(0.5, Math.min(2, currentScale * scaleDelta));
  setScale(newScale);
}

// åœ°å›¾æ‹–æ‹½
function handleDrag(event: MouseEvent) {
  if (!isDragging) return;
  
  const dx = event.clientX - lastMousePosition.x;
  const dy = event.clientY - lastMousePosition.y;
  
  setViewport({
    x: viewport.x + dx,
    y: viewport.y + dy
  });
}

// æ™ºèƒ½ä½“é€‰ä¸­
function handleAgentClick(agentId: string) {
  selectAgent(agentId);
  
  // å¦‚æœå¼€å¯äº†è·Ÿéšæ¨¡å¼,åœ°å›¾è·Ÿéšæ™ºèƒ½ä½“
  if (isFollowing) {
    centerOnAgent(agentId);
  }
}
```

## æ€§èƒ½ä¼˜åŒ–

### æ¸²æŸ“ä¼˜åŒ–

```typescript
// 1. åªæ¸²æŸ“å¯è§åŒºåŸŸå†…çš„æ™ºèƒ½ä½“
function getVisibleAgents(agents: Agent[], viewport: Rect, padding: number = 100) {
  return agents.filter(agent => 
    agent.x >= viewport.x - padding &&
    agent.x <= viewport.x + viewport.width + padding &&
    agent.y >= viewport.y - padding &&
    agent.y <= viewport.y + viewport.height + padding
  );
}

// 2. ä½¿ç”¨å¯¹è±¡æ± å¤ç”¨ç²¾çµ
const spritePool: PIXI.Sprite[] = [];

function getSprite(): PIXI.Sprite {
  return spritePool.pop() || new PIXI.Sprite();
}

function releaseSprite(sprite: PIXI.Sprite) {
  sprite.visible = false;
  spritePool.push(sprite);
}

// 3. æ‰¹é‡æ›´æ–°çŠ¶æ€
function batchUpdateAgents(updates: AgentUpdate[]) {
  // ä½¿ç”¨ requestAnimationFrame åˆå¹¶æ›´æ–°
  requestAnimationFrame(() => {
    updates.forEach(update => {
      agentStore.updateAgent(update.id, update.changes);
    });
  });
}
```

### å†…å­˜ä¼˜åŒ–

```typescript
// é™åˆ¶äº‹ä»¶å†å²
const MAX_EVENTS = 500;

function addEvent(event: WorldEvent) {
  events.push(event);
  if (events.length > MAX_EVENTS) {
    events.shift(); // ç§»é™¤æœ€æ—§çš„
  }
}

// é™åˆ¶å¯¹è¯æ°”æ³¡æ˜¾ç¤ºæ•°é‡
const MAX_VISIBLE_BUBBLES = 10;
```

## ç´ æèµ„æº

### ç²¾çµå›¾è§„æ ¼

```
/public/assets/
â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ male_programmer.png     (64x64)
â”‚   â”œâ”€â”€ female_designer.png     (64x64)
â”‚   â”œâ”€â”€ male_waiter.png         (64x64)
â”‚   â””â”€â”€ ...
â”œâ”€â”€ locations/
â”‚   â”œâ”€â”€ cafe.png                (100x80)
â”‚   â”œâ”€â”€ office.png              (200x150)
â”‚   â”œâ”€â”€ park.png                (250x200)
â”‚   â””â”€â”€ ...
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ bubble.9.png            (9-patchæ°”æ³¡)
â”‚   â”œâ”€â”€ icons.png               (å›¾æ ‡ç²¾çµå›¾)
â”‚   â””â”€â”€ ...
â””â”€â”€ map/
    â”œâ”€â”€ ground.png              (åœ°é¢çº¹ç†)
    â””â”€â”€ road.png                (é“è·¯çº¹ç†)
```

### é¢œè‰²è§„èŒƒ

```css
:root {
  /* ä¸»è‰² */
  --primary: #3B82F6;        /* è“è‰² */
  --secondary: #10B981;      /* ç»¿è‰² */
  
  /* çŠ¶æ€è‰² */
  --success: #22C55E;
  --warning: #F59E0B;
  --danger: #EF4444;
  --info: #06B6D4;
  
  /* ä¸­æ€§è‰² */
  --bg-primary: #FFFFFF;
  --bg-secondary: #F3F4F6;
  --text-primary: #111827;
  --text-secondary: #6B7280;
  --border: #E5E7EB;
  
  /* æƒ…ç»ªè‰² */
  --emotion-happy: #FEF3C7;
  --emotion-sad: #DBEAFE;
  --emotion-angry: #FEE2E2;
  --emotion-neutral: #FFFFFF;
}
```

## ç›®å½•ç»“æ„

```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ App.tsx
â”‚   â”œâ”€â”€ main.tsx
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â”‚   â”œâ”€â”€ TopBar.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ MainLayout.tsx
â”‚   â”‚   â”‚   â””â”€â”€ SidePanel.tsx
â”‚   â”‚   â”œâ”€â”€ world/
â”‚   â”‚   â”‚   â”œâ”€â”€ WorldMap.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ AgentSprite.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ LocationSprite.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatBubble.tsx
â”‚   â”‚   â”‚   â””â”€â”€ PathLine.tsx
â”‚   â”‚   â”œâ”€â”€ panels/
â”‚   â”‚   â”‚   â”œâ”€â”€ AgentListPanel.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ AgentDetailPanel.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ EventStream.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ StatsPanel.tsx
â”‚   â”‚   â”‚   â””â”€â”€ SocialGraph.tsx
â”‚   â”‚   â””â”€â”€ ui/
â”‚   â”‚       â”œâ”€â”€ Button.tsx
â”‚   â”‚       â”œâ”€â”€ Input.tsx
â”‚   â”‚       â”œâ”€â”€ Badge.tsx
â”‚   â”‚       â””â”€â”€ ProgressBar.tsx
â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â”œâ”€â”€ worldStore.ts
â”‚   â”‚   â”œâ”€â”€ agentStore.ts
â”‚   â”‚   â”œâ”€â”€ eventStore.ts
â”‚   â”‚   â””â”€â”€ conversationStore.ts
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useWebSocket.ts
â”‚   â”‚   â”œâ”€â”€ usePixiApp.ts
â”‚   â”‚   â””â”€â”€ useViewport.ts
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ format.ts
â”‚   â”‚   â”œâ”€â”€ animation.ts
â”‚   â”‚   â””â”€â”€ pathfinding.ts
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”œâ”€â”€ agent.ts
â”‚   â”‚   â”œâ”€â”€ world.ts
â”‚   â”‚   â””â”€â”€ event.ts
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ client.ts
â”œâ”€â”€ public/
â”‚   â””â”€â”€ assets/
â”œâ”€â”€ index.html
â”œâ”€â”€ package.json
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ tailwind.config.js
â””â”€â”€ tsconfig.json
```
